webpackJsonp([1],{"8oJS":function(t,e){},QE0B:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("BO1k"),o=a.n(n),i=a("mvHQ"),r=a.n(i),s=a("7I1f"),l={name:"UserView",data:function(){return{check:!1,queryParam:{userName:"",account:""},channelList:[{id:0,channelName:"科技馆"},{id:1,channelName:"毛纪"},{id:2,channelName:"故宫"},{id:3,channelName:"国博"}],channelObj:{0:"科技馆",1:"毛纪",2:"故宫",3:"国博"},userData:[],page:{pageNum:1,pageSize:30,total:0},showDialog:!1,labelPosition:"right",formData:{},ownerList:[],showAccountLogin:!1,accountLoginInfo:{phone:"",captchaImage:"",captchaImageBase64:"",verificationCode:"",uuid:""},showCapt:!0,checkRes:{}}},mounted:function(){this.queryUser(),this.getAllUser()},methods:{queryUser:function(){var t=this;this.queryParam.page=this.page,Object(s.b)("/ticket/account/list",this.queryParam).then(function(e){0!=e.status?t.$notify.error({title:"查询失败",message:e.msg,duration:2e3}):(t.userData=e.data.list,t.page.total=e.data.total,t.page.pageSize=e.data.pageSize)})},addUser:function(){this.formData={},this.showDialog=!0},editUser:function(t){this.showDialog=!0,this.formData=t},deleteUser:function(t){var e=this;Object(s.a)("/ticket/account/del",{id:t}).then(function(t){0!=t.status?e.$notify.error({title:"失败",message:t.msg,duration:2e3}):(e.showDialog=!1,e.queryUser())})},frozenUser:function(t){var e=this;t.status=0==t.status?1:0,Object(s.b)("/ticket/account/update",t).then(function(t){0!=t.status?e.$notify.error({title:"失败",message:t.msg,duration:2e3}):e.queryUser()})},getAllUser:function(){var t=this;Object(s.b)("/ticket/user/list/all",{}).then(function(e){0!=e.status?t.$notify.error({title:"查询失败",message:e.msg,duration:2e3}):t.ownerList=e.data})},handleSizeChange:function(t){this.page.pageSize=t,this.queryUser()},handleCurrentChange:function(t){this.page.pageNum=t,this.queryUser()},onSubmit:function(){var t=this;this.formData?Object(s.b)("/ticket/account/update",this.formData).then(function(e){0!=e.status?t.$notify.error({title:"失败",message:e.msg,duration:2e3}):(t.showDialog=!1,t.queryUser())}):Object(s.b)("/ticket/account/add",this.formData).then(function(e){0!=e.status?t.$notify.error({title:"失败",message:e.msg,duration:2e3}):(t.showDialog=!1,t.queryUser())})},closeForm:function(){this.showDialog=!1},loginAccount:function(t){this.accountLoginInfo={},this.accountLoginInfo.phone=t.account,this.getCaptcha()},getCaptcha:function(){var t=this;this.showCapt=!1,this.accountLoginInfo.captchaImageBase64="",Object(s.a)("/ticket/account/getCaptcha",null).then(function(e){if(0!=e.status)t.$notify.error({title:"失败",message:e.msg,duration:2e3});else{t.showCapt=!0;var a=e.data.captchaImageBase64;t.accountLoginInfo.captchaImageBase64="data:image/png;base64,"+a,t.accountLoginInfo.uuid=e.data.uuid,t.showAccountLogin=!0}})},getMsgCode:function(){var t=this;this.accountLoginInfo.captchaImage.length<4?this.$notify.error({title:"请输入正确图形验证码",duration:2e3}):Object(s.b)("/ticket/account/getMsgCode",this.accountLoginInfo).then(function(e){0!=e.status?t.$notify.error({title:"失败",message:e.msg,duration:2e3}):t.$notify.success({title:"成功",message:e.msg,duration:2e3})})},doLogin:function(){var t=this;this.accountLoginInfo.captchaImage.length<4?this.$notify.error({title:"请输入正确图形验证码",duration:2e3}):this.accountLoginInfo.verificationCode.length<6?this.$notify.error({title:"请检查短信验证码是否正确",duration:2e3}):Object(s.b)("/ticket/account/login",this.accountLoginInfo).then(function(e){0!=e.status?t.$notify.error({title:"失败",message:e.msg,duration:2e3}):(t.$notify.success({title:"成功",message:e.msg,duration:2e3}),t.showAccountLogin=!1)})},checkUserAuth:function(){var t=this;this.check=!0,this.checkRes={},Object(s.a)("/ticket/account/check",null).then(function(e){if(0!=e.status)t.$notify.error({title:"失败",message:e.msg,duration:2e3}),t.check=!1;else{t.checkRes=e.data;var a=[],n=!0,i=!1,s=void 0;try{for(var l,c=o()(t.userData);!(n=(l=c.next()).done);n=!0){var u=l.value,m=!0,f=!1,h=void 0;try{for(var g,d=o()(t.checkRes);!(m=(g=d.next()).done);m=!0){var p=g.value;u.id!=p.accountId||(u.check=p.checkRes,u.checkMsg=p.msg,a.push(u))}}catch(t){f=!0,h=t}finally{try{!m&&d.return&&d.return()}finally{if(f)throw h}}}}catch(t){i=!0,s=t}finally{try{!n&&c.return&&c.return()}finally{if(i)throw s}}t.userData=JSON.parse(r()(a)),t.check=!1}})}}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{staticStyle:{"margin-top":"2em"},attrs:{inline:!0,model:t.queryParam}},[a("el-form-item",{attrs:{label:"账号名称"}},[a("el-input",{attrs:{placeholder:"用户名",clearable:""},model:{value:t.queryParam.userName,callback:function(e){t.$set(t.queryParam,"userName",e)},expression:"queryParam.userName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"账号"}},[a("el-input",{attrs:{placeholder:"账号",clearable:""},model:{value:t.queryParam.account,callback:function(e){t.$set(t.queryParam,"account",e)},expression:"queryParam.account"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"渠道"}},[a("el-select",{attrs:{clearable:""},model:{value:t.queryParam.channel,callback:function(e){t.$set(t.queryParam,"channel",e)},expression:"queryParam.channel"}},t._l(t.channelList,function(t){return a("el-option",{key:t.id,attrs:{label:t.channelName,value:t.id}})}),1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small",round:""},on:{click:t.queryUser}},[t._v("查询")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"small",round:""},on:{click:t.addUser}},[t._v("新建账号")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"small",round:"",loading:t.check},on:{click:t.checkUserAuth}},[t._v("检查登录态")])],1)],1),t._v(" "),a("div",[a("el-table",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:t.userData,border:"",height:"75vh"}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{prop:"userName",label:"账号名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.userName)+"\n              "),0==e.row.check?a("span",{staticStyle:{color:"#f56c6c"}},[t._v("\n                "+t._s(e.row.checkMsg)+"\n              ")]):t._e()])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"channel",label:"渠道"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("div",[t._v(t._s(t.channelObj[n.channel]))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"account",label:"账号"}}),t._v(" "),a("el-table-column",{attrs:{label:"是否有效"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.status?t._e():a("el-link",{staticClass:"el-icon-success",attrs:{type:"success",underline:!1}}),t._v(" "),e.row.status?a("el-link",{attrs:{icon:"el-icon-error",type:"danger",underline:!1}}):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",prop:"option"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-link",{attrs:{type:"primary"},on:{click:function(a){return t.editUser(e.row)}}},[t._v("编辑\n            ")]),t._v(" "),e.row.status?t._e():a("el-link",{attrs:{type:"danger"},on:{click:function(a){return t.frozenUser(e.row)}}},[t._v("禁用\n            ")]),t._v(" "),e.row.status?a("el-link",{attrs:{type:"danger"},on:{click:function(a){return t.frozenUser(e.row)}}},[t._v("启用\n            ")]):t._e(),t._v(" "),a("el-link",{attrs:{type:"danger"},on:{click:function(a){return t.deleteUser(e.row.id)}}},[t._v("删除\n            ")]),t._v(" "),0==e.row.channel?a("el-link",{attrs:{type:"primary"},on:{click:function(a){return t.loginAccount(e.row)}}},[t._v("登录\n            ")]):t._e()]}}])})],1),t._v(" "),a("el-pagination",{attrs:{"current-page":t.page.pageNum,"page-size":30,"page-sizes":[30,50,100],total:t.page.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t._v(" "),a("el-dialog",{staticStyle:{height:"50em",overflow:"unset"},attrs:{top:"2vh",visible:t.showDialog},on:{"update:visible":function(e){t.showDialog=e}}},[a("el-form",{staticStyle:{"margin-left":"5vw"},attrs:{"label-position":t.labelPosition,"label-width":"80px",model:t.formData}},[a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{staticClass:"inputStyle",model:{value:t.formData.userName,callback:function(e){t.$set(t.formData,"userName",e)},expression:"formData.userName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"渠道"}},[a("el-select",{model:{value:t.formData.channel,callback:function(e){t.$set(t.formData,"channel",e)},expression:"formData.channel"}},t._l(t.channelList,function(t){return a("el-option",{key:t.id,attrs:{label:t.channelName,value:t.id}})}),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"所有者"}},[a("el-select",{attrs:{clearable:""},model:{value:t.formData.belongUser,callback:function(e){t.$set(t.formData,"belongUser",e)},expression:"formData.belongUser"}},t._l(t.ownerList,function(t){return a("el-option",{key:t.id,attrs:{label:t.nickName,value:t.id}})}),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"账号"}},[a("el-input",{staticClass:"inputStyle",model:{value:t.formData.account,callback:function(e){t.$set(t.formData,"account",e)},expression:"formData.account"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"密码"}},[a("el-input",{staticClass:"inputStyle",model:{value:t.formData.pwd,callback:function(e){t.$set(t.formData,"pwd",e)},expression:"formData.pwd"}})],1),t._v(" "),a("el-form-item",[a("el-button",{staticStyle:{"margin-left":"20vw"},attrs:{type:"primary",round:""},on:{click:t.onSubmit}},[t._v("保存")]),t._v(" "),a("el-button",{attrs:{type:"warning",round:""},on:{click:t.closeForm}},[t._v("取消")])],1)],1)],1),t._v(" "),a("el-dialog",{attrs:{visible:t.showAccountLogin,width:"30%"},on:{"update:visible":function(e){t.showAccountLogin=e}}},[a("el-form",{staticStyle:{"margin-left":"3em"},attrs:{model:t.accountLoginInfo,"label-position":t.labelPosition}},[a("el-form-item",{attrs:{label:"当前账号:"}},[a("el-tag",{attrs:{type:"success"}},[t._v(t._s(t.accountLoginInfo.phone))])],1),t._v(" "),a("el-form-item",{attrs:{label:"图形验证码:"}},[a("el-col",{attrs:{span:12}},[a("el-input",{attrs:{placeholder:"图形验证码",clearable:""},model:{value:t.accountLoginInfo.captchaImage,callback:function(e){t.$set(t.accountLoginInfo,"captchaImage",e)},expression:"accountLoginInfo.captchaImage"}}),t._v(" "),t.showCapt?a("el-image",{attrs:{src:t.accountLoginInfo.captchaImageBase64},on:{click:t.getCaptcha}}):t._e()],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"短信验证码:",inline:!0}},[a("el-input",{staticStyle:{width:"40%"},attrs:{clearable:""},model:{value:t.accountLoginInfo.verificationCode,callback:function(e){t.$set(t.accountLoginInfo,"verificationCode",e)},expression:"accountLoginInfo.verificationCode"}}),t._v(" "),a("el-button",{attrs:{type:"info",size:"small",plain:""},on:{click:t.getMsgCode}},[t._v("获取验证码")])],1),t._v(" "),a("el-form-item",[a("el-button",{staticStyle:{"margin-left":"22em"},attrs:{type:"primary",size:"small",round:""},on:{click:t.doLogin}},[t._v("登录")])],1)],1)],1)],1)},staticRenderFns:[]};var u=a("VU/8")(l,c,!1,function(t){a("8oJS")},null,null);e.default=u.exports},mvHQ:function(t,e,a){t.exports={default:a("qkKv"),__esModule:!0}},qkKv:function(t,e,a){var n=a("FeBl"),o=n.JSON||(n.JSON={stringify:JSON.stringify});t.exports=function(t){return o.stringify.apply(o,arguments)}}});
//# sourceMappingURL=1.3ee7aa4dbf37602fb01c.js.map